<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qualit√§tspr√ºfung - NEXUS OVERLORD</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div class="container">
        <header>
            <h1>‚úÖ QUALIT√ÑTSPR√úFUNG</h1>
            <p>{{ projekt.name }}</p>
        </header>

        <main>
            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                    {% for category, message in messages %}
                        <div class="flash-message flash-{{ category }}">
                            {{ message }}
                        </div>
                    {% endfor %}
                {% endif %}
            {% endwith %}

            <div class="qualitaet-container">

                <!-- Gesamt-Bewertung Box -->
                <div class="qualitaet-gesamt-box">
                    <div class="gesamt-bewertung">
                        <div class="sterne-display-gro√ü">
                            {% for i in range(1, 11) %}
                                {% if i <= qualitaet.gesamt_bewertung %}
                                    <span class="stern-gro√ü stern-filled">‚òÖ</span>
                                {% else %}
                                    <span class="stern-gro√ü stern-empty">‚òÜ</span>
                                {% endif %}
                            {% endfor %}
                        </div>
                        <div class="bewertung-zahl">{{ qualitaet.gesamt_bewertung }}/10</div>
                    </div>
                    <div class="gesamt-kommentar">
                        {{ qualitaet.gesamt_kommentar }}
                    </div>
                </div>

                <!-- Kategorien -->
                <div class="kategorien-section">
                    <h2>üìä Bewertung nach Kategorien</h2>
                    <div class="kategorien-grid">
                        {% for kat in qualitaet.kategorien %}
                        <div class="kategorie-card {{ kat.color_class }}">
                            <div class="kategorie-header">
                                <span class="kategorie-icon">{{ kat.icon }}</span>
                                <span class="kategorie-name">{{ kat.name }}</span>
                                <span class="kategorie-bewertung">{{ kat.bewertung }}/10</span>
                            </div>
                            <div class="kategorie-kommentar">
                                {{ kat.kommentar }}
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>

                <!-- Verbesserungen (falls vorhanden) -->
                {% if qualitaet.verbesserungen and qualitaet.verbesserungen|length > 0 %}
                <div class="verbesserungen-section">
                    <h2>üí° Verbesserungsvorschl√§ge</h2>
                    <div class="verbesserungen-liste">
                        {% for verb in qualitaet.verbesserungen %}
                        <div class="verbesserung-item verbesserung-{{ verb.typ }}">
                            <div class="verbesserung-header">
                                <span class="verbesserung-auftrag">Auftrag {{ verb.auftrag }}</span>
                                <span class="verbesserung-typ-badge">{{ verb.typ }}</span>
                            </div>
                            <div class="verbesserung-text">
                                {{ verb.text }}
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}

                <!-- Warnungen (falls vorhanden) -->
                {% if qualitaet.warnungen and qualitaet.warnungen|length > 0 %}
                <div class="warnungen-section">
                    <h2>‚ö†Ô∏è Warnungen</h2>
                    <div class="warnungen-liste">
                        {% for warnung in qualitaet.warnungen %}
                        <div class="warnung-item">
                            <div class="warnung-icon">‚ö†Ô∏è</div>
                            <div class="warnung-text">{{ warnung }}</div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}

                <!-- Fazit -->
                <div class="fazit-box">
                    <h3>üéØ Fazit</h3>
                    <p>{{ qualitaet.fazit }}</p>
                </div>

                <!-- Actions -->
                <div class="qualitaet-actions">
                    <a href="/projekt/{{ projekt.id }}/auftraege" class="btn btn-secondary">
                        ‚Üê Zur√ºck zu Auftr√§gen
                    </a>
                    <form action="/projekt/{{ projekt.id }}/abschliessen" method="POST" style="display: inline;" id="abschliessenForm">
                        <button type="submit" class="btn btn-primary" id="abschliessenBtn">
                            ‚úÖ Speichern & Abschlie√üen
                        </button>
                    </form>
                </div>

                <div class="next-step-info">
                    <strong>üéØ N√§chster Schritt:</strong>
                    Alle Daten werden in der Datenbank gespeichert. Projekt-Status wird auf "BEREIT" gesetzt.
                </div>

                <!-- Loading Overlay (hidden by default) -->
                <div id="loadingOverlay" class="loading-overlay" style="display: none;">
                    <div class="loading-spinner">
                        <div class="spinner"></div>
                        <p class="loading-text">Speichere Projekt in Datenbank...</p>
                        <p class="loading-subtext">Phasen, Auftr√§ge, Qualit√§t</p>
                    </div>
                </div>

            </div>

        </main>

        <footer>
            <p>NEXUS OVERLORD v2.0 - Multi-Agent Intelligence</p>
        </footer>
    </div>

    <script>
        // Loading-Anzeige beim Submit
        document.getElementById('abschliessenForm').addEventListener('submit', function() {
            document.getElementById('loadingOverlay').style.display = 'flex';
            document.getElementById('abschliessenBtn').disabled = true;
        });
    </script>
</body>
</html>
