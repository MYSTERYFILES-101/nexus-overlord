<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phasen Ergebnis - NEXUS OVERLORD</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div class="container">
        <header>
            <h1>‚úÖ PHASEN ERFOLGREICH GENERIERT</h1>
            <p>{{ projekt.name }}</p>
        </header>

        <main>
            <!-- Flash Messages -->
            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                    {% for category, message in messages %}
                        <div class="flash-message flash-{{ category }}">
                            {{ message }}
                        </div>
                    {% endfor %}
                {% endif %}
            {% endwith %}

            <div class="phasen-ergebnis-container">

                <!-- √úbersicht Box -->
                <div class="phasen-overview-box">
                    <div class="overview-stat">
                        <span class="stat-number">{{ phasen_data.gesamt_phasen }}</span>
                        <span class="stat-label">Phasen</span>
                    </div>
                    <div class="overview-stat">
                        <span class="stat-number">{{ phasen_data.gesamt_dauer }}</span>
                        <span class="stat-label">Gesch√§tzte Dauer</span>
                    </div>
                </div>

                <!-- Strategische Hinweise (falls vorhanden) -->
                {% if phasen_data.hinweise %}
                <div class="hinweise-box">
                    <div class="hinweise-icon">üí°</div>
                    <div class="hinweise-content">
                        <strong>Strategische Hinweise:</strong>
                        <p>{{ phasen_data.hinweise }}</p>
                    </div>
                </div>
                {% endif %}

                <!-- Phasen-Liste -->
                <div class="phasen-liste-section">
                    <h2>üìã Phasen-√úbersicht</h2>

                    {% for phase in phasen_data.phasen %}
                    <div class="phase-card priority-{{ phase.prioritaet }}">
                        <div class="phase-header">
                            <span class="phase-nummer">#{{ phase.nummer }}</span>
                            <h3 class="phase-name">{{ phase.name }}</h3>
                            <span class="phase-priority-badge priority-badge-{{ phase.prioritaet }}">
                                {% if phase.prioritaet == 'hoch' %}
                                    üî¥ HOCH
                                {% elif phase.prioritaet == 'mittel' %}
                                    üü° MITTEL
                                {% else %}
                                    üü¢ NIEDRIG
                                {% endif %}
                            </span>
                        </div>

                        <div class="phase-body">
                            <p class="phase-beschreibung">{{ phase.beschreibung }}</p>

                            <div class="phase-meta">
                                <div class="phase-meta-item">
                                    <span class="meta-icon">‚è±Ô∏è</span>
                                    <span class="meta-text">{{ phase.geschaetzte_dauer }}</span>
                                </div>

                                {% if phase.abhaengigkeiten %}
                                <div class="phase-meta-item">
                                    <span class="meta-icon">üîó</span>
                                    <span class="meta-text">
                                        Abh√§ngigkeiten: 
                                        {% for dep in phase.abhaengigkeiten %}
                                            Phase {{ dep }}{% if not loop.last %}, {% endif %}
                                        {% endfor %}
                                    </span>
                                </div>
                                {% else %}
                                <div class="phase-meta-item">
                                    <span class="meta-icon">‚úì</span>
                                    <span class="meta-text">Keine Abh√§ngigkeiten</span>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    {% endfor %}

                </div>

                <!-- Actions -->
                <div class="phasen-ergebnis-actions">
                    <a href="/projekt/{{ projekt.id }}/phasen" class="btn btn-secondary">
                        ‚Ü© Nochmal generieren
                    </a>
                    <form action="/projekt/{{ projekt.id }}/auftraege/generieren" method="POST" style="display: inline;" id="auftraegeForm">
                        <button type="submit" class="btn btn-primary" id="generateAuftraegeBtn">
                            ‚úÖ Weiter zu Auftr√§gen
                        </button>
                    </form>
                </div>

                <!-- Info -->
                <div class="next-step-info">
                    <strong>üéØ N√§chster Schritt:</strong>
                    Opus 4.5 wird f√ºr jede Phase konkrete Auftr√§ge mit Regelwerk erstellen.
                </div>

                <!-- Loading Overlay (hidden by default) -->
                <div id="loadingOverlay" class="loading-overlay" style="display: none;">
                    <div class="loading-spinner">
                        <div class="spinner"></div>
                        <p class="loading-text">Opus 4.5 erstellt Auftr√§ge...</p>
                        <p class="loading-subtext">Dies kann 60-120 Sekunden dauern</p>
                    </div>
                </div>

            </div>

        </main>

        <footer>
            <p>NEXUS OVERLORD v2.0 - Multi-Agent Intelligence</p>
        </footer>
    </div>

    <script>
        // Loading-Anzeige beim Submit
        document.getElementById('auftraegeForm').addEventListener('submit', function() {
            document.getElementById('loadingOverlay').style.display = 'flex';
            document.getElementById('generateAuftraegeBtn').disabled = true;
        });
    </script>
</body>
</html>
