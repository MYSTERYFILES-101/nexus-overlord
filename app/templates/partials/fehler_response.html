{#
NEXUS OVERLORD v2.0 - Fehler Response Template (Auftrag 4.3)
Zeigt Fehler-Analyse und Lösung im Chat an
#}

<div class="chat-message chat-fehler {% if bekannt %}bekannt{% else %}neu{% endif %}" data-fehler-id="{{ fehler_id }}">
    <!-- Header -->
    <div class="message-header">
        <div class="message-info">
            <span class="message-icon">{% if bekannt %}&#128161;{% else %}&#128269;{% endif %}</span>
            <span class="message-title">
                {% if bekannt %}
                    Bekannte Lösung gefunden!
                {% else %}
                    Neue Fehler-Analyse
                {% endif %}
            </span>
        </div>
        <span class="fehler-kategorie-badge kategorie-{{ kategorie }}">{{ kategorie }}</span>
    </div>

    <!-- Ursache (nur bei neuen Fehlern) -->
    {% if not bekannt and ursache %}
    <div class="fehler-ursache">
        <strong>Ursache:</strong> {{ ursache }}
    </div>
    {% endif %}

    <!-- Statistik (bei bekannten Fehlern) -->
    {% if bekannt %}
    <div class="fehler-statistik">
        <span class="stat-item">
            <span class="stat-icon">&#128200;</span>
            <span>Erfolgsrate: {{ erfolgsrate|round|int }}%</span>
        </span>
        <span class="stat-item">
            <span class="stat-icon">&#128337;</span>
            <span>{{ anzahl }}x aufgetreten</span>
        </span>
    </div>
    {% endif %}

    <!-- Lösung -->
    <div class="fehler-loesung">
        <h4>&#128161; Lösung</h4>
        <pre class="loesung-text">{{ loesung }}</pre>
    </div>

    <!-- Lösungs-Auftrag -->
    <div class="fehler-auftrag">
        <h4>&#128196; Lösungs-Auftrag für Claude Code</h4>
        <pre class="auftrag-text" id="fehlerAuftrag{{ fehler_id }}">{{ auftrag }}</pre>
    </div>

    <!-- Actions -->
    <div class="message-actions">
        <button class="action-btn-small btn-copy" onclick="copyFehlerAuftrag({{ fehler_id }})" title="Auftrag kopieren">
            <span class="btn-icon">&#128203;</span>
            <span class="btn-text">Kopieren</span>
        </button>

        {% if fehler_id %}
        <button class="action-btn-small btn-success-feedback" onclick="sendFehlerFeedback({{ fehler_id }}, true)" title="Hat geholfen">
            <span class="btn-icon">&#128077;</span>
            <span class="btn-text">Hat geholfen</span>
        </button>
        <button class="action-btn-small btn-fail-feedback" onclick="sendFehlerFeedback({{ fehler_id }}, false)" title="Hat nicht geholfen">
            <span class="btn-icon">&#128078;</span>
            <span class="btn-text">Nicht geholfen</span>
        </button>
        {% endif %}
    </div>

    <!-- Copy Feedback -->
    <div class="copy-feedback" id="copyFehlerFeedback{{ fehler_id }}" style="display: none;">
        &#10003; In Zwischenablage kopiert!
    </div>

    <!-- Feedback Response -->
    <div class="feedback-response" id="feedbackResponse{{ fehler_id }}" style="display: none;"></div>
</div>
