# √úBERGABE - AUFTRAG 3.1

## Datum & Zeit
- Datum: 2025-11-24
- Uhrzeit: 08:47

## Auftrag
- Nummer: 3.1
- Name: Gemini: Phasen-Einteilung
- Phase: 3 - Kachel 2: Phasen & Auftr√§ge generieren

## Status
- [x] Erledigt

---

## Was wurde gemacht

### 1. Service: Phasen-Generator
**Datei:** `app/services/phasen_generator.py` (neu, 236 Zeilen)

**Funktionen:**
- `generate_phasen(enterprise_plan)` - Hauptfunktion
  - Ruft Gemini 3 Pro via OpenRouter auf
  - Temperature: 0.7, Timeout: 90s
  - Returns: Phasen-Struktur als Dict
- `extract_json(response)` - JSON-Extraktion
  - Unterst√ºtzt: ```json ```, ``` ```, direktes JSON
  - Regex-Fallback f√ºr JSON in Text
  - Robuste Fehlerbehandlung
- `validate_phasen(data)` - Validierung
  - Pr√ºft Struktur und Required Fields
  - Anzahl Phasen: 5-8
  - Priorit√§t: hoch/mittel/niedrig
  - Sequentielle Nummern
- `format_phasen_for_display(data)` - Markdown-Output
  - Formatiert Phasen f√ºr Anzeige
  - √úbersicht + Details

**Prompt-Engineering:**
```python
PHASEN_PROMPT = """
Du bist ein erfahrener Projekt-Stratege...
- Identifiziere Hauptkomponenten
- Gruppiere zusammengeh√∂rige Aufgaben
- Erkenne Abh√§ngigkeiten
- Setze Priorit√§ten
- Sch√§tze Dauer

AUSGABE als JSON (NUR JSON):
{
    "phasen": [...],
    "gesamt_phasen": N,
    "gesamt_dauer": "X Stunden",
    "hinweise": "..."
}
"""
```

### 2. Routes in main.py
**Erweitert:** `app/main.py` (+72 Zeilen)

**Route 1:** `/projekt/<int:projekt_id>/phasen` (GET/POST)
- GET: Zeigt Generator-Formular
- POST: Startet Phasen-Generierung
- L√§dt Projekt aus DB
- Ruft generate_phasen() auf
- Speichert Ergebnis in Session
- Redirect zu Ergebnis-Seite
- Error-Handling mit Flash-Messages

**Route 2:** `/projekt/<int:projekt_id>/phasen/ergebnis`
- Zeigt generierte Phasen
- L√§dt aus Session
- Formatiert mit format_phasen_for_display()
- Rendert Markdown zu HTML

**Route 3:** `/projekt/phasen` (Legacy)
- Redirect zu /projekt/{id}/phasen
- Holt ID aus Session

**Update:** `/projekt/speichern`
- Redirect zu projekt_phasen_view statt projekt_phasen
- Mit projekt_id Parameter

### 3. Template: Generator-UI
**Datei:** `app/templates/projekt_phasen.html` (neu, 89 Zeilen)

**Komponenten:**
- Header: "üî∑ PHASEN & AUFTR√ÑGE GENERIEREN"
- Enterprise-Plan Box:
  - Readonly Anzeige
  - Scrollbar (max-height: 400px)
  - Monospace Font
- Info-Box:
  - Erkl√§rt Gemini-Workflow
  - Gradient-Background (lila)
- Buttons:
  - "‚Üê Zur√ºck zur Startseite"
  - "üîÑ Phasen generieren" (submit)
- Loading-Overlay:
  - Fullscreen mit Spinner
  - "Gemini 3 Pro analysiert..."
  - "30-60 Sekunden"
- JavaScript:
  - Zeigt Overlay beim Submit
  - Disabled Button w√§hrend Loading

### 4. Template: Ergebnis-Anzeige
**Datei:** `app/templates/projekt_phasen_ergebnis.html` (neu, 136 Zeilen)

**Komponenten:**
- Header: "‚úÖ PHASEN ERFOLGREICH GENERIERT"
- √úbersicht-Box:
  - Anzahl Phasen (gro√üe Zahl)
  - Gesch√§tzte Gesamtdauer
  - Gradient-Background
- Hinweise-Box (falls vorhanden):
  - Gelber Hintergrund
  - Strategische Empfehlungen
- Phasen-Liste:
  - Phase-Cards mit:
    - Nummer (runder Badge)
    - Name (Titel)
    - Priorit√§ts-Badge (Rot/Gelb/Gr√ºn)
    - Beschreibung
    - Meta-Daten:
      - Dauer (‚è±Ô∏è)
      - Abh√§ngigkeiten (üîó) oder "Keine" (‚úì)
  - Hover-Effekt (lift & shadow)
  - Border-Left farbig nach Priorit√§t
- Buttons:
  - "‚Ü© Nochmal generieren"
  - "‚úÖ Weiter zu Auftr√§gen" (Placeholder)
- Info-Box:
  - "üéØ N√§chster Schritt: Auftrag 3.2"

### 5. CSS-Styling
**Datei:** `static/css/style.css` (+357 Zeilen)

**Phasen-Generator:**
- `.phasen-generator-container` - Layout
- `.enterprise-plan-box` - Scrollbar, Monospace
- `.info-box-phasen` - Gradient, Flex-Layout
- `.loading-overlay` - Fullscreen, z-index 9999
- `.spinner` - Rotating border animation

**Phasen-Ergebnis:**
- `.phasen-overview-box` - Stats mit Gradient
- `.hinweise-box` - Gelbe Warn-Box
- `.phase-card` - Wei√üe Cards mit Shadow
  - Hover: lift + shadow
  - Border-left farbig:
    - Rot (#e74c3c) = hoch
    - Gelb (#f39c12) = mittel
    - Gr√ºn (#2ecc71) = niedrig
- `.phase-priority-badge` - Farbige Badges
- `.phase-meta` - Icons + Text (Flex)
- `.next-step-info` - Blaue Info-Box

**Responsive:**
- Mobile: Stacked Layout
- Flexible Phase-Cards

---

## Dateien

### Neu (3 Dateien):
- `app/services/phasen_generator.py` (236 Zeilen)
- `app/templates/projekt_phasen.html` (89 Zeilen)
- `app/templates/projekt_phasen_ergebnis.html` (136 Zeilen)

### Aktualisiert (2 Dateien):
- `app/main.py` (+72 Zeilen, 3 neue Routes)
- `static/css/style.css` (+357 Zeilen)

**Gesamt: +890 Zeilen Code**

---

## GitHub
- Commit: [3.1] Gemini Phasen-Einteilung
- Hash: 5786a23
- Push: ‚úÖ Erfolgreich

---

## Wie es funktioniert

### User-Flow:
1. User klickt "Weiter zu Phasen & Auftr√§ge" nach Projekt-Speicherung
2. ‚Üí `/projekt/{id}/phasen` (Generator-UI)
3. Enterprise-Plan wird angezeigt (readonly)
4. User klickt "üîÑ Phasen generieren"
5. Loading-Overlay erscheint
6. **Gemini 3 Pro analysiert Plan (30-90s)**
7. JSON mit 5-8 Phasen wird generiert
8. Validierung + Session-Speicherung
9. ‚Üí `/projekt/{id}/phasen/ergebnis` (Ergebnis-UI)
10. Phasen-Cards werden angezeigt

### Gemini-Workflow:
```
Enterprise-Plan
    ‚Üì
PHASEN_PROMPT
    ‚Üì
Gemini 3 Pro (OpenRouter)
    ‚Üì
JSON-Response
    ‚Üì
extract_json()
    ‚Üì
validate_phasen()
    ‚Üì
Session Storage
    ‚Üì
Ergebnis-Anzeige
```

### JSON-Struktur:
```json
{
    "phasen": [
        {
            "nummer": 1,
            "name": "Setup & Grundlagen",
            "beschreibung": "Detaillierte Beschreibung...",
            "abhaengigkeiten": [],
            "prioritaet": "hoch",
            "geschaetzte_dauer": "2-3 Stunden"
        },
        ...
    ],
    "gesamt_phasen": 6,
    "gesamt_dauer": "15-20 Stunden",
    "hinweise": "Strategische Empfehlungen..."
}
```

---

## N√§chster Auftrag
- Phase: 3 - Kachel 2
- Nummer: 3.2
- Name: Sonnet: Auftr√§ge + Regelwerk
- Beschreibung: Sonnet 4.5 erstellt f√ºr jede Phase konkrete Auftr√§ge mit Regelwerk

---

## Erfolgs-Kriterien
- [x] Route /projekt/{id}/phasen erreichbar
- [x] Enterprise-Plan wird aus DB geladen
- [x] Gemini wird korrekt aufgerufen
- [x] JSON-Response wird geparst
- [x] 5-8 Phasen werden generiert
- [x] Phasen haben: Nummer, Name, Beschreibung, Abh√§ngigkeiten
- [x] Ergebnis wird in Session gespeichert
- [x] UI zeigt Phasen-Liste an
- [x] Loading-Anzeige funktioniert
- [x] Priorit√§ts-Badges farbig
- [x] Abh√§ngigkeiten-Anzeige
- [x] Responsive Design
- [x] GitHub gepusht
- [x] √úbergabe geschrieben

---

## Technische Details

### OpenRouter API Call:
```python
client = get_client()
response = client.call_gemini([
    {"role": "user", "content": prompt}
], temperature=0.7, timeout=90)
```

### Error-Handling:
- API-Fehler ‚Üí Flash Error + Redirect
- JSON-Parse-Fehler ‚Üí ValueError mit Details
- Validierungs-Fehler ‚Üí ValueError mit Field
- Keine Phasen in Session ‚Üí Redirect zu Generator

### Session-Daten:
```python
session['phasen_data'] = {
    "phasen": [...],
    "gesamt_phasen": 6,
    ...
}
session['projekt_id'] = projekt_id
```

---

**√úbergeben von:** Claude Code (Sonnet 4.5)  
**Zeitstempel:** 2025-11-24 08:47 UTC  
**Phase:** 3 von 7 (Auftrag 1 von 4)  
**Fortschritt Phase 3:** 25% (1/4)  

‚úÖ GEMINI PHASEN-EINTEILUNG FERTIG!

üéØ NEXT: Auftrag 3.2 - Sonnet erstellt Auftr√§ge + Regelwerk
